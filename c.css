:root {
  --bg-deep: #2d1208;
  --bg-warm: #5a1f0f;
  --felt: #7b2f16;
  --felt-dark: #4f1f12;
  --gold: #d7a13c;
  --gold-soft: #f0d08a;
  --ivory: #f7ecd4;
  --jade: #2f6b5e;
  --turquoise: #3f8f84;
  --danger: #9f2f24;
  --card: rgba(44, 16, 10, 0.9);
  --line: rgba(240, 208, 138, 0.25);
}

* {
  margin: 0;
  padding: 0;
  box-sizing: border-box;
}

body {
  min-height: 100vh;
  display: flex;
  justify-content: center;
  align-items: center;
  padding: 24px;
  background:
    radial-gradient(circle at 20% 20%, rgba(240, 208, 138, 0.12), transparent 32%),
    radial-gradient(circle at 80% 80%, rgba(63, 143, 132, 0.12), transparent 38%),
    linear-gradient(145deg, var(--bg-deep), var(--bg-warm));
  color: var(--ivory);
  font-family: "Palatino Linotype", "Book Antiqua", Georgia, serif;
  overflow: hidden;
  position: relative;
}

body::before {
  content: "";
  position: fixed;
  inset: 0;
  background-image:
    linear-gradient(45deg, rgba(215, 161, 60, 0.05) 25%, transparent 25%),
    linear-gradient(-45deg, rgba(215, 161, 60, 0.05) 25%, transparent 25%);
  background-size: 48px 48px;
  pointer-events: none;
  z-index: 0;
}

.geometric-shapes {
  position: fixed;
  inset: 0;
  z-index: 0;
  pointer-events: none;
}

.shape {
  position: absolute;
  border: 2px solid rgba(215, 161, 60, 0.24);
  border-radius: 50%;
  animation: drift 18s linear infinite;
}

.shape::before {
  content: "";
  position: absolute;
  inset: 18%;
  border: 1px dashed rgba(240, 208, 138, 0.3);
  border-radius: 50%;
}

.shape:nth-child(1) { width: 190px; height: 190px; top: 8%; left: 12%; }
.shape:nth-child(2) { width: 140px; height: 140px; top: 65%; left: 8%; animation-delay: -4s; }
.shape:nth-child(3) { width: 220px; height: 220px; top: 12%; right: 8%; animation-delay: -9s; }
.shape:nth-child(4) { width: 120px; height: 120px; bottom: 12%; right: 18%; animation-delay: -13s; }

@keyframes drift {
  0% { transform: translateY(0) rotate(0deg); }
  50% { transform: translateY(-16px) rotate(180deg); }
  100% { transform: translateY(0) rotate(360deg); }
}

.game-container {
  position: relative;
  z-index: 1;
  width: min(92vw, 640px);
  display: grid;
  grid-template-areas:
    "title score"
    "grid grid"
    "blocks blocks";
  gap: 18px;
  padding: 24px;
  border-radius: 20px;
  background: linear-gradient(160deg, rgba(62, 24, 14, 0.95), rgba(37, 14, 9, 0.95));
  border: 2px solid rgba(215, 161, 60, 0.5);
  box-shadow:
    0 16px 50px rgba(0, 0, 0, 0.45),
    inset 0 0 0 1px rgba(240, 208, 138, 0.14);
}

.game-container::before {
  content: "";
  position: absolute;
  inset: 10px;
  border: 1px solid rgba(240, 208, 138, 0.25);
  border-radius: 14px;
  pointer-events: none;
}

h1 {
  grid-area: title;
  align-self: center;
  font-size: clamp(1.8rem, 3.2vw, 2.5rem);
  letter-spacing: 0.08em;
  text-transform: uppercase;
  background: linear-gradient(180deg, var(--gold-soft), var(--gold));
  -webkit-background-clip: text;
  background-clip: text;
  color: transparent;
  text-shadow: 0 0 18px rgba(215, 161, 60, 0.28);
}

.score-display {
  grid-area: score;
  justify-self: end;
  align-self: center;
  font-size: 1.2rem;
  font-weight: 700;
  padding: 10px 16px;
  border-radius: 10px;
  border: 1px solid var(--line);
  background: rgba(24, 10, 7, 0.8);
  color: var(--gold-soft);
}

.game-grid {
  grid-area: grid;
  display: grid;
  grid-template-columns: repeat(8, minmax(34px, 1fr));
  gap: 5px;
  width: 100%;
  max-width: 476px;
  margin: 0 auto;
  padding: 12px;
  border-radius: 12px;
  background:
    linear-gradient(135deg, rgba(30, 11, 7, 0.94), rgba(60, 23, 14, 0.92));
  border: 1px solid rgba(215, 161, 60, 0.3);
}

.grid-cell {
  width: 100%;
  aspect-ratio: 1;
  border-radius: 8px;
  background: rgba(247, 236, 212, 0.09);
  border: 1px solid rgba(240, 208, 138, 0.2);
  transition: transform 0.15s ease, background 0.2s ease;
}

.grid-cell.valid-drop {
  background: rgba(63, 143, 132, 0.42);
  box-shadow: inset 0 0 0 2px rgba(108, 195, 178, 0.88);
}

.grid-cell.invalid-drop {
  background: rgba(159, 47, 36, 0.45);
  box-shadow: inset 0 0 0 2px rgba(228, 113, 101, 0.8);
  animation: invalidPulse 0.6s ease infinite;
}

@keyframes invalidPulse {
  50% { transform: scale(0.97); }
}

.upcoming-blocks-container {
  grid-area: blocks;
  display: flex;
  flex-wrap: wrap;
  justify-content: center;
  gap: 14px;
  width: 100%;
}

.upcoming-block {
  width: 116px;
  height: 116px;
  border-radius: 12px;
  border: 1px solid rgba(215, 161, 60, 0.35);
  background: linear-gradient(145deg, rgba(24, 10, 7, 0.92), rgba(53, 21, 13, 0.9));
  padding: 10px;
  display: flex;
  justify-content: center;
  align-items: center;
  cursor: grab;
  transition: transform 0.2s ease, box-shadow 0.2s ease;
}

.upcoming-block:hover {
  transform: translateY(-3px);
  box-shadow: 0 8px 20px rgba(0, 0, 0, 0.32);
}

.upcoming-block.dragging {
  transform: scale(1.04);
  opacity: 0.86;
  cursor: grabbing;
}

.upcoming-block-grid {
  width: 100%;
  height: 100%;
  display: grid;
  gap: 4px;
  padding: 3px;
}

.upcoming-block-grid:not(.horizontal-1x3):not(.vertical-1x3) {
  grid-template-columns: repeat(2, 1fr);
  grid-template-rows: repeat(2, 1fr);
}

.upcoming-block-grid.vertical-1x3 {
  grid-template-columns: 1fr;
  grid-template-rows: repeat(3, 1fr);
  width: 40px;
  height: 100px;
}

.upcoming-block-grid.horizontal-1x3 {
  grid-template-columns: repeat(3, 1fr);
  grid-template-rows: 1fr;
  width: 100px;
  height: 40px;
}

.upcoming-block-cell {
  border-radius: 6px;
  border: 1px solid rgba(247, 236, 212, 0.26);
  box-shadow: inset 0 1px 3px rgba(0, 0, 0, 0.28);
}

.particle {
  position: absolute;
  width: 8px;
  height: 8px;
  border-radius: 50%;
  pointer-events: none;
  z-index: 10;
  animation: particle-explosion 0.6s ease-out forwards, particle-rotation 0.6s linear forwards;
}

@keyframes particle-explosion {
  to {
    transform: translate(var(--x), var(--y)) scale(0);
    opacity: 0;
  }
}

@keyframes particle-rotation {
  to { transform: rotate(var(--rotation)); }
}

.combo-text,
.points-text,
.mega-combo-text,
.mega-combo-points,
.mega-combo-break-text {
  position: absolute;
  transform: translate(-50%, -50%);
  z-index: 1000;
  pointer-events: none;
}

.combo-text {
  font-size: 2.1rem;
  font-weight: 900;
  letter-spacing: 0.05em;
  color: var(--gold-soft);
  text-shadow: 0 0 14px rgba(23, 10, 8, 0.9);
  animation: comboAppear 0.35s ease-out;
}

.points-text {
  font-size: 1.3rem;
  font-weight: 700;
  color: var(--ivory);
}

.combo-text.fade-out,
.points-text.fade-out,
.mega-combo-text.fade-out,
.mega-combo-points.fade-out,
.mega-combo-break-text.fade-out,
.no-convergence-message.fade-out {
  animation: fadeOut 0.5s ease-out forwards;
}

@keyframes comboAppear {
  from { opacity: 0; transform: translate(-50%, -30%) scale(0.85); }
  to { opacity: 1; transform: translate(-50%, -50%) scale(1); }
}

@keyframes fadeOut {
  to { opacity: 0; transform: translate(-50%, -70%) scale(0.9); }
}

.combo-text[data-combo="2"] { color: #f9d67a; }
.combo-text[data-combo="3"] { color: #f5b84f; }
.combo-text[data-combo="4"] { color: #f58d4f; }
.combo-text[data-combo="5"] { color: #ec654f; }
.combo-text[data-combo="6"] {
  background: linear-gradient(180deg, #f7eac2, #f0b651, #c24a2b);
  -webkit-background-clip: text;
  background-clip: text;
  color: transparent;
}

.combo-spark {
  position: absolute;
  width: 4px;
  height: 4px;
  border-radius: 50%;
  animation: sparkFly 0.6s linear forwards;
}

@keyframes sparkFly {
  to {
    transform: translate(var(--spark-x, 40px), var(--spark-y, -40px)) scale(0);
    opacity: 0;
  }
}

.combo-wave {
  position: absolute;
  top: 50%;
  left: 50%;
  width: 24px;
  height: 24px;
  border: 2px solid var(--combo-color);
  border-radius: 50%;
  transform: translate(-50%, -50%);
  animation: waveExpand 0.8s ease-out forwards;
}

@keyframes waveExpand {
  to {
    width: 180px;
    height: 180px;
    opacity: 0;
    border-width: 1px;
  }
}

.mega-combo-text {
  font-size: clamp(2rem, 5vw, 3.2rem);
  font-weight: 900;
  color: transparent;
  background: linear-gradient(180deg, #f8e9be, #d7a13c, #8c3720);
  -webkit-background-clip: text;
  background-clip: text;
  text-shadow: 0 0 22px rgba(215, 161, 60, 0.3);
}

.mega-combo-points {
  font-size: 2rem;
  font-weight: 800;
  color: var(--ivory);
}

.mega-combo-particle {
  position: absolute;
  width: 8px;
  height: 8px;
  top: 50%;
  left: 50%;
  border-radius: 50%;
  animation: particleExplode 1.5s ease-out forwards;
}

@keyframes particleExplode {
  to {
    transform:
      translate(
        calc(-50% + cos(var(--angle)) * var(--distance)),
        calc(-50% + sin(var(--angle)) * var(--distance))
      )
      scale(0.4);
    opacity: 0;
  }
}

.mega-combo-break-text {
  font-size: clamp(2rem, 4vw, 3rem);
  font-weight: 900;
  color: #ffcf99;
  text-shadow: 0 0 18px rgba(159, 47, 36, 0.7);
}

.no-convergence-message {
  position: absolute;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
  z-index: 1000;
  padding: 12px 22px;
  border-radius: 10px;
  border: 1px solid rgba(240, 208, 138, 0.45);
  background: rgba(99, 28, 21, 0.94);
  color: #ffd9c9;
  font-size: 1.1rem;
  font-weight: 700;
}

.game-over-message {
  position: absolute;
  inset: 0;
  z-index: 100;
  display: flex;
  justify-content: center;
  align-items: center;
  background: rgba(10, 4, 3, 0.78);
}

.game-over-content {
  width: min(88%, 360px);
  padding: 24px;
  text-align: center;
  border-radius: 14px;
  background: linear-gradient(160deg, #f5e5bf, #eac57f);
  color: #32150d;
  border: 2px solid #9d6b23;
}

.game-over-content h2 {
  margin-bottom: 10px;
  font-size: 2rem;
}

.game-over-content p {
  margin-bottom: 12px;
  font-size: 1.1rem;
}

.restart-button {
  margin-top: 6px;
  border: none;
  border-radius: 8px;
  padding: 10px 16px;
  font-size: 1rem;
  font-weight: 700;
  color: var(--ivory);
  background: linear-gradient(145deg, #8c3720, #5f2414);
  cursor: pointer;
  transition: transform 0.15s ease, box-shadow 0.15s ease;
}

.restart-button:hover {
  transform: translateY(-2px);
  box-shadow: 0 6px 14px rgba(0, 0, 0, 0.3);
}

.upcoming-block:has(.vertical-1x3) {
  width: 60px;
  height: 116px;
}

.upcoming-block:has(.horizontal-1x3) {
  width: 116px;
  height: 60px;
}

.upcoming-block-grid.l-shaped {
  display: grid;
  grid-template-columns: repeat(2, 1fr);
  grid-template-rows: repeat(2, 1fr);
  width: 80px;
  height: 80px;
  gap: 4px;
}

.upcoming-block-grid.l-shaped[data-rotation="0"] .upcoming-block-cell:nth-child(1) { grid-column: 1; grid-row: 1; }
.upcoming-block-grid.l-shaped[data-rotation="0"] .upcoming-block-cell:nth-child(2) { grid-column: 2; grid-row: 1; }
.upcoming-block-grid.l-shaped[data-rotation="0"] .upcoming-block-cell:nth-child(3) { grid-column: 1; grid-row: 2; }
.upcoming-block-grid.l-shaped[data-rotation="1"] .upcoming-block-cell:nth-child(1) { grid-column: 1; grid-row: 1; }
.upcoming-block-grid.l-shaped[data-rotation="1"] .upcoming-block-cell:nth-child(2) { grid-column: 1; grid-row: 2; }
.upcoming-block-grid.l-shaped[data-rotation="1"] .upcoming-block-cell:nth-child(3) { grid-column: 2; grid-row: 2; }
.upcoming-block-grid.l-shaped[data-rotation="2"] .upcoming-block-cell:nth-child(1) { grid-column: 1; grid-row: 1; }
.upcoming-block-grid.l-shaped[data-rotation="2"] .upcoming-block-cell:nth-child(2) { grid-column: 2; grid-row: 1; }
.upcoming-block-grid.l-shaped[data-rotation="2"] .upcoming-block-cell:nth-child(3) { grid-column: 2; grid-row: 2; }
.upcoming-block-grid.l-shaped[data-rotation="3"] .upcoming-block-cell:nth-child(1) { grid-column: 1; grid-row: 1; }
.upcoming-block-grid.l-shaped[data-rotation="3"] .upcoming-block-cell:nth-child(2) { grid-column: 2; grid-row: 1; }
.upcoming-block-grid.l-shaped[data-rotation="3"] .upcoming-block-cell:nth-child(3) { grid-column: 2; grid-row: 2; }

@media (max-width: 700px) {
  body { padding: 12px; }
  .game-container {
    width: 100%;
    grid-template-areas:
      "title"
      "score"
      "grid"
      "blocks";
    padding: 16px;
  }
  .score-display {
    justify-self: start;
  }
  .game-grid {
    max-width: 100%;
  }
}
